/**
 * Author:  Roni
 * Created: 23/03/2018
 */
CREATE DATABASE GESTAOVENDAS;

CREATE TABLE CLIENTE (
  IDCLIENTE    INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  NOME         VARCHAR(50) NOT NULL,
  CPF          VARCHAR(14) NOT NULL UNIQUE,
  CLIENTEESPECIAL     VARCHAR(1) NOT NULL DEFAULT 'N',
     CHECK (CLIENTEESPECIAL='S' OR CLIENTEESPECIAL='N')
  );
CREATE INDEX CLINOME ON CLIENTE (NOME);

CREATE TABLE VENDEDOR (
  IDVENDEDOR   INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  NOME         VARCHAR(50) NOT NULL,
  CPF          VARCHAR(14) NOT NULL UNIQUE,
  MATRICULA    VARCHAR(1) NOT NULL UNIQUE
  );
CREATE INDEX VENNOME ON VENDEDOR (NOME);

CREATE TABLE ENDERECO (
  IDENDERECO    INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  IDCLIENTE     INT NOT NULL,
  IDVENDEDOR    INT NOT NULL,
  CEP           VARCHAR (8),
  RUA           VARCHAR(20) NOT NULL,
  NUMERO        VARCHAR(10) NOT NULL,
  COMPLEMENTO   VARCHAR (50),
  CONSTRAINT FK_ENDERECO_CLIENTE FOREIGN KEY (IDCLIENTE)
  REFERENCES CLIENTE (IDCLIENTE),
  CONSTRAINT FK_ENDERECO_VENDEDOR FOREIGN KEY (IDVENDEDOR)
  REFERENCES VENDEDOR (IDVENDEDOR)  
);
 
CREATE TABLE VEICULO (
  IDVEICULO     INT NOT NULL PRIMARY KEY,
  NOME          VARCHAR(50) NOT NULL,
  FABRICANTE    VARCHAR(50) NOT NULL,
  VEICULONOVO   VARCHAR(1)  NOT NULL,
  PLACA         VARCHAR(7),
  CHECK (VEICULONOVO='S' OR VEICULONOVO='N')
);

CREATE TABLE VENDA (
  IDVENDA       INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  IDVENDEDOR    INT NOT NULL,
  IDCLIENTE     INT NOT NULL,
  IDVEICULO     INT NOT NULL,
  DATA          TIMESTAMP NOT NULL,
  CONSTRAINT FK_VENDA_CLIENTE FOREIGN KEY (IDCLIENTE)
  REFERENCES CLIENTE (IDCLIENTE),
  CONSTRAINT FK_VENDA_VENDEDOR FOREIGN KEY (IDVENDEDOR)
  REFERENCES VENDEDOR (IDVENDEDOR),
  CONSTRAINT FK_VENDA_VEICULO FOREIGN KEY (IDVEICULO),
  REFERENCES VEICULO (IDVEICULO)  
);
CREATE INDEX VENDATA ON VENDA (DATA);
